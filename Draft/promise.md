å‰ç«¯é¢†åŸŸä¸­è®¸å¤šè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜èƒŒåï¼Œå…¶å®éƒ½è•´å«ç€ç»å…¸çš„è®¡ç®—æœºç§‘å­¦åŸºç¡€çŸ¥è¯†ã€‚åœ¨ä»Šå¤©ï¼Œåªè¦ä½ ä½¿ç”¨ JS å‘èµ·è¿‡ç½‘ç»œè¯·æ±‚ï¼Œé‚£å…¶å®ä½ åŸºæœ¬å°±ä½¿ç”¨è¿‡äº†å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ Monadã€‚è¿™æ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿè®©æˆ‘ä»¬ä»å›è°ƒåœ°ç‹±è¯´èµ·å§â€¦â€¦

## å›è°ƒåœ°ç‹±ä¸ Promise

ç†Ÿæ‚‰ JS çš„åŒå­¦å¯¹äºå›è°ƒå‡½æ•°ä¸€å®šä¸ä¼šé™Œç”Ÿï¼Œè¿™æ˜¯è¿™é—¨è¯­è¨€ä¸­å¤„ç†å¼‚æ­¥äº‹ä»¶æœ€å¸¸ç”¨çš„æ‰‹æ³•ã€‚ç„¶è€Œæ­£å¦‚æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„é‚£æ ·ï¼Œ**é¡ºåºå¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡**çš„å·¥ä½œæµå¾ˆå®¹æ˜“é€ æˆå›è°ƒçš„åµŒå¥—ï¼Œä½¿å¾—ä»£ç éš¾ä»¥ç»´æŠ¤ï¼š

```
$.get(a, (b) => {
  $.get(b, (c) => {
    $.get(c, (d) => {
      console.log(d)
    })
  })
})
å¤åˆ¶ä»£ç 
```

é•¿ä¹…ä»¥æ¥è¿™ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°ç€å¹¿å¤§ JSerï¼Œç¤¾åŒºçš„è§£å†³æ–¹æ¡ˆä¹Ÿæ˜¯ç™¾èŠ±é½æ”¾ã€‚å…¶ä¸­ä¸€ç§å·²ç»æˆä¸ºæ ‡å‡†çš„æ–¹æ¡ˆå«åš **Promise**ï¼Œä½ å¯ä»¥å°†å¼‚æ­¥å›è°ƒ**åŒ…åœ¨ Promise é‡Œ**ï¼Œç”± `Promise.then` æ–¹æ³•é“¾å¼ç»„åˆå¼‚æ­¥å·¥ä½œï¼š

```
const getB = a =>newPromise((resolve, reject) => $.get(a, resolve))

const getC = b =>newPromise((resolve, reject) => $.get(b, resolve))

const getD = c =>newPromise((resolve, reject) => $.get(c, resolve))

getB(a)
  .then(getC)
  .then(getD)
  .then(console.log)
å¤åˆ¶ä»£ç 
```

è™½ç„¶ ES7 é‡Œå·²ç»æœ‰äº†æ›´ç®€ç»ƒçš„ async/await è¯­æ³•ï¼Œä½† Promise å·²ç»æœ‰äº†éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚æ¯”å¦‚ï¼Œç½‘ç»œè¯·æ±‚çš„æ–°æ ‡å‡† fetch ä¼šå°†è¿”å›å†…å®¹å°è£…ä¸º Promiseï¼Œç›®å‰æœ€æµè¡Œçš„ Ajax åº“ axios ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚è‡³äºä¸€åº¦å é¢† 70% ç½‘é¡µçš„å…ƒè€åŸºç¡€åº“ jQueryï¼Œæ—©åœ¨ 1.5 ç‰ˆæœ¬ä¸­å°±æ”¯æŒäº† Promiseã€‚è¿™å°±æ„å‘³ç€ï¼Œåªè¦ä½ åœ¨å‰ç«¯å‘èµ·è¿‡ç½‘ç»œè¯·æ±‚ï¼Œä½ åŸºæœ¬ä¸Šå°±å’Œ Promise æ‰“è¿‡äº¤é“ã€‚**è€Œ Promise æœ¬èº«ï¼Œå°±æ˜¯ä¸€ç§ Monadã€‚**

ä¸è¿‡ï¼Œå„ç±»å¯¹ Promise çš„ä»‹ç»å¤šåŠé›†ä¸­åœ¨å®ƒçš„å„ç§çŠ¶æ€è¿ç§»å’Œ API ä½¿ç”¨ä¸Šï¼Œè¿™å’Œ Monad å¬èµ·æ¥ä¼¼ä¹å®Œå…¨å…«ç«¿å­æ‰“ä¸ç€ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µä¹‹é—´æœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿè¦è®²æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è‡³å°‘å¾—ææ‡‚ **Monad æ˜¯ä»€ä¹ˆ**ã€‚

## å†¬ä¸‰é›ªç¢§ä¸ Monad

å¾ˆå¤šæœ¬æ¥æœ‰å…´è¶£å­¦ä¹  Haskell ç­‰å‡½æ•°å¼è¯­è¨€çš„åŒå­¦ï¼Œéƒ½å¯èƒ½è¢«ä¸€å¥åè¨€éœ‡æ…‘åˆ°æ‰“é€€å ‚é¼“â€”â€”ã€Monad ä¸å°±æ˜¯è‡ªå‡½å­ä¸Šçš„å¹ºåŠç¾¤å—ï¼Œæœ‰ä»€ä¹ˆéš¾ä»¥ç†è§£çš„ã€‘ã€‚å…¶å®è¿™å¥è¯å’Œç™½å­¦å®¶è¯´çš„ã€[å†¬é©¬å°ä¸‰ï¼Œé›ªèœç¢§æ± ](https://zh.moegirl.org/%E5%86%AC%E4%B8%89%E9%9B%AA%E7%A2%A7) (target=undefined rel=undefined)ã€‘æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œä¸è¿‡æ˜¯ä¸€å¥æ­£ç¡®çš„åºŸè¯è€Œå·²ï¼Œå¬å®Œæ‡‚çš„äººè¿˜æ˜¯æ‡‚ï¼Œä¸æ‡‚çš„äººè¿˜æ˜¯ä¸æ‡‚ã€‚æ‰€ä»¥å¦‚æœå†æœ‰äººå’Œä½ è¿™ä¹ˆä»‹ç» Monadï¼Œè¯·æ”¾å¿ƒåœ°æ‰“æ­»ä»–å§â€”â€”å–‚ç­‰ç­‰ï¼Œè°è¯´å†¬ä¸‰é›ªç¢§æ˜¯æ­£ç¡®çš„äº†ï¼

å›å½’æ­£é¢˜ï¼ŒMonad åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¤§å¯ä¸å¿…æ‹¿å‡º PLT æˆ– Haskell é‚£ä¸€å¥—ï¼Œè€Œæ˜¯åœ¨ JS çš„è¯­å¢ƒé‡Œå¥½å¥½è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼šæ—¢ç„¶ Promise åœ¨ JS é‡Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç±»ä¼¼åœ°ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠ Monad å½“åšä¸€ä¸ª**ç‰¹æ®Šçš„å¯¹è±¡**ã€‚

æ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒçš„é»‘é­”æ³•ä¹Ÿä¸å¤–ä¹å­˜åœ¨äºå±æ€§å’Œæ–¹æ³•ä¸¤ä¸ªåœ°æ–¹é‡Œäº†ã€‚ä¸‹é¢æˆ‘ä»¬è¦å›ç­”ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ï¼š**Monad æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å±æ€§å’Œæ–¹æ³•ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬é€ƒç¦»å›è°ƒåœ°ç‹±å‘¢ï¼Ÿ**

æˆ‘ä»¬å¯ä»¥ç”¨**éå¸¸ç®€å•**çš„ä¼ªä»£ç æ¥æ¾„æ¸…è¿™ä¸ªé—®é¢˜ã€‚å‡å¦‚æˆ‘ä»¬æœ‰ A B C D å››ä»¶äº‹è¦åšï¼Œé‚£ä¹ˆåŸºäºå›è°ƒåµŒå¥—ï¼Œä½ å¯ä»¥å†™å‡ºæœ€ç®€å•çš„å‡½æ•°è¡¨è¾¾å¼å½¢å¦‚ï¼š

```
A(B(C(D)))
å¤åˆ¶ä»£ç 
```

çœ‹åˆ°åµŒå¥—å›è°ƒçš„å™©æ¢¦äº†å§ï¼Ÿä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½ä¸å‰¥èŒ§åœ°ç®€åŒ–è¿™ä¸ªåœºæ™¯ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠé—®é¢˜ç®€åŒ–åˆ°æœ€æ™®é€šçš„å›è°ƒåµŒå¥—ï¼š

```
A(B)
å¤åˆ¶ä»£ç 
```

åŸºäº**æ·»åŠ ä¸­é—´å±‚**å’Œ**æ§åˆ¶åè½¬**çš„ç†å¿µï¼Œæˆ‘ä»¬åªéœ€åå‡ è¡Œä»£ç ï¼Œå°±èƒ½å¤Ÿå®ç°ä¸€ä¸ªç®€å•çš„ä¸­é—´å¯¹è±¡ Pï¼ŒæŠŠ A å’Œ B åˆ†å¼€ä¼ ç»™è¿™ä¸ªå¯¹è±¡ï¼Œä»è€ŒæŠŠå›è°ƒæ‹†åˆ†å¼€ï¼š

```
P(A).then(B)
å¤åˆ¶ä»£ç 
```

ç°åœ¨ï¼ŒA è¢«æˆ‘ä»¬åŒ…è£…äº†ä¸€å±‚ï¼ŒP è¿™ä¸ª**å®¹å™¨**å°±æ˜¯ Promise çš„é›å½¢äº†ï¼åœ¨ç¬”è€…çš„åšæ–‡ [ä»æºç çœ‹ Promise æ¦‚å¿µä¸å®ç°](http://ewind.us/2017/promise-implementing/) (target=undefined rel=undefined) ä¸­ï¼Œå·²ç»è§£é‡Šäº†è¿™æ ·å°†å›è°ƒåµŒå¥—è§£é™¤çš„åŸºæœ¬æœºåˆ¶äº†ï¼Œç›¸åº”çš„ä»£ç å®ç°åœ¨æ­¤ä¸å†èµ˜è¿°ã€‚

ä½†æ˜¯ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆåªé€‚ç”¨äº A B ä¸¤ä¸ªå‡½æ•°ä¹‹é—´å‘ç”ŸåµŒå¥—çš„åœºæ™¯ã€‚åªè¦ä½ å°è¯•å»å®ç°è¿‡è¿™ä¸ªç‰ˆæœ¬çš„ Pï¼Œä½ ä¸€å®šä¼šå‘ç°ï¼Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰è¿™ç§èƒ½åŠ›ï¼š

```
P(A).then(B).then(C).then(D)
å¤åˆ¶ä»£ç 
```

ä¹Ÿæ²¡æœ‰è¿™ç§èƒ½åŠ›ï¼š

```
P(P(P(A))).then(B)
å¤åˆ¶ä»£ç 
```

è¿™å°±æ˜¯ Monad å¤§å±•èº«æ‰‹çš„æ—¶å€™äº†ï¼æˆ‘ä»¬é¦–å…ˆç»™å‡ºç­”æ¡ˆï¼š **Monad å¯¹è±¡æ˜¯è¿™ä¸ªç®€é™‹ç‰ˆ `P` çš„å¼ºåŒ–ï¼Œå®ƒçš„ `then` èƒ½æ”¯æŒè¿™ç§åµŒå¥—å’Œé“¾å¼è°ƒç”¨çš„åœºæ™¯ã€‚** å½“ç„¶ï¼Œæ­£ç»Ÿçš„ Monad é‡Œè¿™ä¸ª API ä¸æ˜¯è¿™ä¸ªåå­—ï¼Œä½†ä½œä¸ºå‚ç…§ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ Promise/A+ è§„èŒƒä¸­çš„ä¸€ä¸ª[å…³é”®ç»†èŠ‚](https://promisesaplus.com/#the-promise-resolution-procedure) (target=undefined rel=undefined)ï¼š

åœ¨æ¯æ¬¡ Resolve ä¸€ä¸ª Promise æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸¤ç§æƒ…å†µï¼š

1. å¦‚æœè¢« Resolve çš„å†…å®¹ä»ç„¶æ˜¯ Promiseï¼ˆå³æ‰€è°“çš„ `thenable`ï¼‰ï¼Œé‚£ä¹ˆ**é€’å½’ Resolve** è¿™ä¸ª Promiseã€‚
2. å¦‚æœè¢« Resolve çš„å†…å®¹ä¸æ˜¯ Promiseï¼Œé‚£ä¹ˆæ ¹æ®å†…å®¹çš„å…·ä½“æƒ…å†µï¼ˆå¦‚å¯¹è±¡ã€å‡½æ•°ã€åŸºæœ¬ç±»å‹ç­‰ï¼‰ï¼Œå» `fulfill` æˆ– `reject` å½“å‰ Promiseã€‚

ç›´è§‚åœ°è¯´ï¼Œè¿™ä¸ªç»†èŠ‚èƒ½å¤Ÿä¿è¯ä¸‹é¢ä¸¤ç§è°ƒç”¨æ–¹å¼å®Œå…¨ç­‰æ•ˆï¼š

```
// 1Promise.resolve(1).then(console.log)

// 1Promise.resolve(
  Promise.resolve(
    Promise.resolve(
      Promise.resolve(1)
    )
  )
).then(console.log)
å¤åˆ¶ä»£ç 
```

è¿™é‡Œçš„åµŒå¥—æ˜¯å¦ä¼¼æ›¾ç›¸è¯†ï¼Ÿè¿™å®é™…ä¸Šå°±æ˜¯æŠ«ç€ Promise å¤–è¡£çš„ Monad æ ¸å¿ƒèƒ½åŠ›ï¼šå¯¹äºä¸€ä¸ª P è¿™æ ·è£…ç€**æŸç§å†…å®¹**çš„å®¹å™¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿ**é€’å½’åœ°æŠŠå®¹å™¨ä¸€å±‚å±‚æ‹†å¼€ï¼Œç›´æ¥å–å‡ºæœ€é‡Œé¢è£…ç€çš„å€¼**ã€‚åªè¦å®ç°äº†è¿™ä¸ªèƒ½åŠ›ï¼Œé€šè¿‡ä¸€äº›æŠ€å·§ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç°ä¸‹é¢è¿™ä¸ªä¼˜é›…çš„**é“¾å¼è°ƒç”¨** APIï¼š

```
Promise(A).then(B).then(C).then(D)
å¤åˆ¶ä»£ç 
```

è¿™æ›´å¸¦æ¥äº†é¢å¤–çš„å¥½å¤„ï¼šä¸ç®¡è¿™é‡Œé¢çš„ B C D å‡½æ•°è¿”å›çš„æ˜¯åŒæ­¥æ‰§è¡Œçš„å€¼è¿˜æ˜¯å¼‚æ­¥è§£æçš„ Promiseï¼Œæˆ‘ä»¬éƒ½èƒ½**å®Œå…¨ä¸€è‡´åœ°**å¤„ç†ã€‚æ¯”å¦‚è¿™ä¸ªåŒæ­¥çš„åŠ æ³•ï¼š

```
const add = x => x + 1Promise
  .resolve(0)
  .then(add)
  .then(add)
  .then(console.log)
// 2å¤åˆ¶ä»£ç 
```

å’Œè¿™ä¸ªç•¥æ˜¾æ‹§å·´çš„å¼‚æ­¥åŠ æ³•ï¼š

```
const add = x =>newPromise((resolve, reject) => setTimeout(() => resolve(x + 1), 1000))

Promise
  .resolve(0)
  .then(add)
  .then(add)
  .then(console.log)
// 2å¤åˆ¶ä»£ç 
```

ä¸åˆ†åŒæ­¥ä¸å¼‚æ­¥ï¼Œå®ƒä»¬çš„è°ƒç”¨æ–¹å¼ä¸æœ€ç»ˆç»“æœå®Œå…¨ä¸€è‡´ï¼

ä½œä¸ºä¸€ä¸ªæ€»ç»“ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»å›è°ƒåœ°ç‹±åˆ° Promise çš„è¿‡ç¨‹ä¸­ï¼ŒèƒŒåè¿ç”¨äº†å“ªäº›å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„æ¦‚å¿µå‘¢ï¼Ÿ

- æœ€ç®€å•çš„ `P(A).then(B)` å®ç°é‡Œï¼Œå®ƒçš„ `P(A)` ç›¸å½“äº Monad ä¸­çš„ `unit` æ¥å£ï¼Œèƒ½å¤Ÿ**æŠŠä»»æ„å€¼åŒ…è£…åˆ° Monad å®¹å™¨é‡Œ**ã€‚
- æ”¯æŒåµŒå¥—çš„ Promise å®ç°ä¸­ï¼Œå®ƒçš„ `then` èƒŒåå…¶å®æ˜¯ FP ä¸­çš„ `join` æ¦‚å¿µï¼Œ**åœ¨å®¹å™¨é‡Œè¿˜è£…ç€å®¹å™¨çš„æ—¶å€™ï¼Œé€’å½’åœ°æŠŠå†…å±‚å®¹å™¨æ‹†å¼€ï¼Œè¿”å›æœ€åº•å±‚è£…ç€çš„å€¼ã€‚**
- Promise çš„é“¾å¼è°ƒç”¨èƒŒåï¼Œå…¶å®æ˜¯ Monad ä¸­çš„ `bind` æ¦‚å¿µã€‚ä½ å¯ä»¥æ‰å¹³åœ°ä¸²è”ä¸€å † `.then()`ï¼Œå¾€é‡Œä¼ å…¥å„ç§å‡½æ•°ï¼ŒPromise èƒ½å¤Ÿå¸®ä½ æŠ¹å¹³åŒæ­¥å’Œå¼‚æ­¥çš„å·®å¼‚ï¼ŒæŠŠè¿™äº›å‡½æ•°**é€ä¸ªåº”ç”¨åˆ°å®¹å™¨é‡Œçš„å€¼ä¸Š**ã€‚

å›å½’è¿™èŠ‚ä¸­æœ€åŸå§‹çš„é—®é¢˜ï¼Œ**Monad æ˜¯ä»€ä¹ˆå‘¢**ï¼Ÿåªè¦ä¸€ä¸ªå¯¹è±¡å…·å¤‡äº†ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ Monad äº†ï¼š

1. **èƒ½å¤ŸæŠŠä¸€ä¸ªå€¼åŒ…è£…ä¸ºå®¹å™¨** - åœ¨ FP é‡Œé¢è¿™å«åš `unit`ã€‚
2. **å¯¹å®¹å™¨é‡Œè£…ç€çš„å€¼ï¼Œèƒ½å¤ŸæŠŠä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°å€¼ä¸Š** - è¿™é‡Œçš„éš¾ç‚¹åœ¨äºï¼Œå®¹å™¨é‡Œå¯èƒ½åµŒå¥—ç€å®¹å™¨ï¼Œå› æ­¤åº”ç”¨å‡½æ•°åˆ°å€¼ä¸Šçš„æ—¶å€™éœ€è¦é€’å½’ã€‚åœ¨ FP é‡Œé¢è¿™å«åš `bind`ï¼ˆè¿™å’Œ JS é‡Œçš„ `bind` å®Œå…¨æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œè¯·ä¸è¦æ··æ·†äº†ï¼‰ã€‚

æ­£å¦‚æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ï¼Œ`Promise.resolve()` èƒ½å¤ŸæŠŠä»»æ„å€¼åŒ…è£…åˆ° Promise é‡Œï¼Œè€Œ Promise/A+ è§„èŒƒé‡Œçš„ Resolve ç®—æ³•åˆ™å®é™…ä¸Šå®ç°äº† `bind`ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼šPromise å°±æ˜¯ä¸€ä¸ª Monadã€‚å…¶å®è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°å¥‡çš„ç»“è®ºï¼Œåœ¨ Github ä¸Šæ—©æœ‰äººä»ä»£ç è§’åº¦ç»™å‡ºäº†è¯æ˜ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»[æ„Ÿå—ä¸€ä¸‹](https://gist.github.com/briancavalier/3296186) (target=undefined rel=undefined) :-)

ä½œä¸ºæ€»ç»“ï¼Œæœ€åè€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬æ˜¯æ€ä¹ˆæŠŠ Promise å’Œ Monad è”ç³»èµ·æ¥å‘¢ï¼ŸPromise æ¶ˆé™¤å›è°ƒåœ°ç‹±çš„å…³é”®åœ¨äºï¼š

1. æ‹†åˆ† `A(B)` ä¸º `P(A).then(B)` çš„å½¢å¼ã€‚è¿™å…¶å®å°±æ˜¯ Monad ç”¨æ¥æ„å»ºå®¹å™¨çš„ `unit`ã€‚
2. ä¸åˆ†åŒæ­¥å¼‚æ­¥ï¼Œéƒ½èƒ½å†™ `P(A).then(B).then(C)...`ï¼Œè¿™å…¶å®æ˜¯ Monad é‡Œçš„ `bind`ã€‚

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä» Promise çš„åŠŸèƒ½æ¥ç†è§£ Monad çš„ä½œç”¨ï¼Œå¹¶ç”¨ Monad çš„æ¦‚å¿µæ¥è§£é‡Š Promise çš„è®¾è®¡å•¦ ğŸ˜‰

## ä½•è°“è‡ªå‡½å­ä¸Šçš„å¹ºåŠç¾¤

åˆ°äº†è¿™é‡Œï¼Œåªè¦ä½ ç†è§£äº† Promiseï¼Œé‚£ä¹ˆä½ åº”è¯¥å°±å·²ç»å¯ä»¥ç†è§£ Monad äº†ã€‚ä¸è¿‡ï¼ŒMonad ä¼ è¯´ä¸­ã€è‡ªå‡½å­ä¸Šçš„å¹ºåŠç¾¤ã€‘åˆæ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿå…¶å®åªè¦ä½ è¯»åˆ°äº†è¿™é‡Œï¼Œä½ å°±å·²ç»è§è¯†è¿‡**è‡ªå‡½å­**å’Œ**å¹ºåŠç¾¤**äº†ï¼ˆè¿™é‡Œçš„ç†è§£æœªå¿…å‡†ç¡®ï¼Œæƒå½“æŠ›ç –å¼•ç‰ä¹‹ç”¨ï¼Œå¸Œæœ› dalao æŒ‡æ­£ï¼‰ã€‚

### è‡ªå‡½å­

**å‡½å­**å³æ‰€è°“çš„ Functorï¼Œæ˜¯ä¸€ä¸ªèƒ½æŠŠå€¼è£…åœ¨é‡Œé¢ï¼Œé€šè¿‡ä¼ å…¥å‡½æ•°æ¥å˜æ¢å®¹å™¨å†…å®¹çš„**å®¹å™¨**ï¼šç®€åŒ–çš„ç†è§£é‡Œï¼Œå‰æ–‡ä¸­çš„ `Promise.resolve` å°±ç›¸å½“äºè¿™æ ·çš„æ˜ å°„ï¼Œèƒ½æŠŠä»»æ„å€¼è£…è¿› Promise å®¹å™¨é‡Œã€‚è€Œ**è‡ªå‡½å­**åˆ™æ˜¯ã€èƒ½æŠŠèŒƒç•´æ˜ å°„åˆ°æœ¬èº«ã€‘çš„ Functorï¼Œå¯ä»¥å¯¹åº”äº `Promise(A).then()` é‡Œä»ç„¶è¿”å› Promise æœ¬èº«ã€‚

### å¹ºåŠç¾¤

å¹ºåŠç¾¤å³æ‰€è°“çš„ Monadicï¼Œæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼šå•ä½å…ƒä¸ç»“åˆå¾‹ã€‚

**å•ä½å…ƒ**æ˜¯è¿™æ ·çš„ä¸¤ä¸ªæ¡ä»¶ï¼š

é¦–å…ˆï¼Œä½œç”¨åˆ°å•ä½å…ƒ `unit(a)` ä¸Šçš„ `f`ï¼Œç»“æœå’Œ `f(a)` ä¸€è‡´ï¼š

```
const value = 6const f = x =>Promise.resolve(x + 6)

// ä¸‹é¢ä¸¤ä¸ªå€¼ç›¸ç­‰const left = Promise.resolve(value).then(f)
const right = f(value)
å¤åˆ¶ä»£ç 
```

å…¶æ¬¡ï¼Œä½œç”¨åˆ°éå•ä½å…ƒ `m` ä¸Šçš„ `unit`ï¼Œç»“æœè¿˜æ˜¯ `m` æœ¬èº«ï¼š

```
const value = 6// ä¸‹é¢ä¸¤ä¸ªå€¼ç›¸ç­‰const left = Promise.resolve(value)
const right = Promise.resolve(value).then(x=>Promise.resolve(x))
å¤åˆ¶ä»£ç 
```

è‡³äº**ç»“åˆå¾‹**åˆ™æ˜¯è¿™æ ·çš„æ¡ä»¶ï¼š`(a â€¢ b) â€¢ c` ç­‰äº `a â€¢ (b â€¢ c)`ï¼š

```
const f = a =>Promise.resolve(a * a)
const g = a =>Promise.resolve(a - 6)

const m = Promise.resolve(7)

// ä¸‹é¢ä¸¤ä¸ªå€¼ç›¸ç­‰const left = m.then(f).then(g)
const right = m.then(x => f(x).then(g))
å¤åˆ¶ä»£ç 
```

ä¸Šé¢çŸ­çŸ­çš„å‡ è¡Œä»£ç ï¼Œå…¶å®å°±æ˜¯å¯¹ã€Promise æ˜¯ Monadã€‘çš„ä¸€ä¸ªè¯æ˜äº†ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ—¥å¸¸å¯¹æ¥æ¥å£ç¼–å†™ Promise çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†™çš„ä¸œè¥¿éƒ½å¯ä»¥å…ˆæå‡åˆ°å‡½æ•°å¼ç¼–ç¨‹çš„ Monad å±‚é¢ï¼Œç„¶åç”¨æŠ½è±¡ä»£æ•°å’ŒèŒƒç•´è®ºæ¥è§£é‡Šï¼Œé€¼æ ¼æ˜¯ä¸æ˜¯ç¬é—´æé«˜äº†å‘¢ XD

## æ€»ç»“

ä¸Šé¢æ‰€æœ‰çš„è®ºè¯éƒ½æ²¡æœ‰ç‰µæ‰¯åˆ° `>>==` è¿™æ ·çš„ Haskell å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ç”¨ JS è¿™æ ·ä½é—¨æ§›çš„è¯­è¨€æ¥ä»‹ç» Monad æ˜¯ä»€ä¹ˆï¼Œåˆæœ‰ä»€ä¹ˆç”¨ã€‚æŸç§ç¨‹åº¦ä¸Šç¬”è€…è®¤åŒç‹å çš„è§‚ç‚¹ï¼šå‡½æ•°å¼ç¼–ç¨‹çš„é—¨æ§›è¢«äººä¸ºåœ°æ‹”é«˜æˆ–ç¥è¯äº†ï¼Œæ˜æ˜æ˜¯å®é™…å¼€å‘ä¸­éå¸¸å®ç”¨ä¸”æ˜“äºç†è§£çš„ä¸œè¥¿ï¼Œå´è¦ä½¿ç”¨æ›´éš¾ä»¥æ‡‚çš„ä¸€å¥—æ¦‚å¿µå»å½¢å¼åŒ–åœ°å®šä¹‰å’Œè§£é‡Šï¼Œè¿™ææ€•å¹¶ä¸åˆ©äºä¼˜ç§€å·¥å…·å’Œç†å¿µçš„æ™®åŠã€‚

å½“ç„¶äº†ï¼Œä¸ºäº†ä½“ç°é€¼æ ¼ï¼Œå¦‚æœä¸‹æ¬¡å†æœ‰åŒå­¦é—®ä½  Promise æ˜¯ä»€ä¹ˆï¼Œè¯·è¿™ä¹ˆå›å¤ï¼š

> Promise ä¸å°±æ˜¯è‡ªå‡½å­ä¸Šçš„å¹ºåŠç¾¤å—ï¼Œæœ‰ä»€ä¹ˆéš¾ä»¥ç†è§£çš„ ğŸ™‚

æœ€åæ’æ’­å¹¿å‘Šï¼šç¬”è€…å†™è¿™ç¯‡æ–‡ç« çš„åŠ¨æœºï¼Œæ˜¯æºè‡ªå®ç°ä¸€ä¸ªå®Œå…¨ Promise åŒ–çš„å¼‚æ­¥æ•°æ®è½¬æ¢è½®å­ [Bumpover](https://github.com/doodlewind/bumpover) (target=undefined rel=undefined) æ—¶å¯¹ Promise çš„ä¸€äº›æ–°ç†è§£ã€‚æœ‰å…´è¶£çš„åŒå­¦æ¬¢è¿å…³æ³¨å“¦ XD